"use strict";
var _ = require("lodash");
var geo = require("geolib");
var Localize = (function () {
    function Localize(word) {
        if (word)
            this.loadWorld(word);
    }
    Localize.prototype.loadWorld = function (word) {
    };
    Localize.prototype.getPosition = function (o) {
        if (!(o && o.latitude && o.longitude))
            throw Error("Error");
        var pos = { latitude: o.latitude, longitude: o.longitude };
        var _this = this;
        var State;
        if (o.state && _this.getState(o.state)) {
            State = _this.getState(o.state);
            console.log('ss');
        }
        else {
            console.log('todo');
            throw Error("todo");
        }
        var allprovinces = _this.getProvincesFromState(State.name);
        _.map(allprovinces, function (c) {
            c.distance = geo.getDistance({ latitude: c.latitude, longitude: c.longitude }, pos);
        });
        var reprov = _.take(_.orderBy(allprovinces, ['distance'], ['asc']), 2);
        var provinces = [];
        _.map(reprov, function (c) {
            _.map(_this.getCitiesFromProvinces(c.nativeName, State.name), function (p) {
                p.distance = geo.getDistance({ latitude: p.latitude, longitude: p.longitude }, pos);
                provinces.push(p);
            });
        });
        var cities = _.take(_.orderBy(provinces, ['distance'], ['asc']), 2);
        if (cities[0].distance * 1.4 > cities[0].distance) {
            cities = [cities[0]];
        }
        return cities;
    };
    Localize.prototype.getLocation = function (o) {
        return true;
    };
    Localize.prototype.getinfo = function (o) {
        return true;
    };
    Localize.prototype.getState = function (state, o) {
        var exists = false;
        var answer;
        var _this = this;
        if (!_this.world) {
            console.error("no world");
            return false;
        }
        _.map(_this.world, function (continent) {
            _.map(continent.subcontinents, function (subcontinent) {
                _.map(subcontinent.countries, function (country) {
                    _.map(country.states, function (s) {
                        console.log(s.name);
                        if (s.name === state) {
                            exists = true;
                            answer = s;
                        }
                    });
                    if (!exists) {
                        answer = false;
                    }
                });
            });
        });
        return answer;
    };
    Localize.prototype.getProvincesFromState = function (state) {
        var _this = this;
        var State;
        if (state) {
            State = _this.getState(state);
        }
        else {
            throw Error("todo");
        }
        var provinces = [];
        _.map(State.regions, function (r) {
            _.map(r.cities, function (c) {
                provinces.push(c);
            });
        });
        return provinces;
    };
    Localize.prototype.getCitiesFromProvinces = function (city, state) {
        var _this = this;
        var State;
        if (state) {
            State = _this.getState(state);
        }
        else {
            throw Error("todo");
        }
        var provinces = [];
        _.map(State.regions, function (r) {
            _.map(r.provinces, function (p) {
                if (p.main.nativeName === city) {
                    _.map(p.cities, function (c) {
                        provinces.push(c);
                    });
                }
            });
        });
        return provinces;
    };
    return Localize;
}());
Object.defineProperty(exports, "__esModule", { value: true });
exports.default = Localize;

//# sourceMappingURL=data:application/json;base64,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LENBQUM7UUFFbEIsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztZQUNSLEtBQUssR0FBVyxLQUFLLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFBO1FBRXpDLENBQUM7UUFBQyxJQUFJLENBQUMsQ0FBQztZQUNKLE1BQU0sS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBRXhCLENBQUM7UUFFRCxJQUFJLFNBQVMsR0FBWSxFQUFFLENBQUM7UUFDNUIsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFLFVBQVUsQ0FBQztZQUM1QixDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxTQUFTLEVBQUUsVUFBVSxDQUFDO2dCQUMxQixFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsS0FBSyxJQUFJLENBQUMsQ0FBQyxDQUFDO29CQUM3QixDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxNQUFNLEVBQUUsVUFBVSxDQUFDO3dCQUV2QixTQUFTLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFBO29CQUdyQixDQUFDLENBQUMsQ0FBQTtnQkFDTixDQUFDO1lBR0wsQ0FBQyxDQUFDLENBQUE7UUFFTixDQUFDLENBQUMsQ0FBQTtRQUdGLE1BQU0sQ0FBQyxTQUFTLENBQUE7SUFFcEIsQ0FBQztJQUVMLGVBQUM7QUFBRCxDQTNMQSxBQTJMQyxJQUFBO0FBM0xEOzBCQTJMQyxDQUFBIiwiZmlsZSI6ImluZGV4LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgXyBmcm9tIFwibG9kYXNoXCI7XG5cbmxldCBnZW8gPSByZXF1aXJlKFwiZ2VvbGliXCIpO1xuXG5pbnRlcmZhY2UgSUJvdW5kYXJ5IHtcblxuICAgIGxhdGl0dWRlOiBudW1iZXI7XG4gICAgbG9uZ2l0dWRlOiBudW1iZXI7XG5cbn1cblxuaW50ZXJmYWNlIElHZW9jb2RlcyB7XG4gICAgbmFtZTogc3RyaW5nO1xuICAgIHByb3ZpbmNlczogSUdlb1tdO1xuICAgIGNpdGllczogSUNpdHlbXVxufVxuXG5cblxuaW50ZXJmYWNlIElDaXR5IHtcbiAgICBuYXRpdmVOYW1lOiBzdHJpbmc7XG4gICAgbGF0aXR1ZGU6IG51bWJlcjtcbiAgICBsb25naXR1ZGU6IG51bWJlcjtcbiAgICB6aXBjb2RlOiBudW1iZXI7XG4gICAgY2l0eUNvZGU6IHN0cmluZztcbiAgICBzdGF0ZTogc3RyaW5nO1xuICAgIGNvdW50cnk6IHN0cmluZztcbiAgICBpc29MYW5nOiBzdHJpbmc7XG4gICAgdHo6IHN0cmluZztcbiAgICBjdXJyZW5jeTogc3RyaW5nO1xuICAgIGN1cnJlbmN5U3ltYm9sOiBzdHJpbmc7XG4gICAgZGlzdGFuY2U/OiBudW1iZXI7XG4gICAgc3ViY29udGluZW50OiBzdHJpbmc7XG4gICAgY29udGluZW50OiBzdHJpbmc7XG4gICAgcmVnaW9uOiBzdHJpbmc7XG59XG5cbmludGVyZmFjZSBJR2VvIHtcbiAgICBuYXRpdmVOYW1lOiBzdHJpbmc7XG4gICAgemlwY29kZTogc3RyaW5nO1xuICAgIGNpdGllczogSUNpdHlbXTtcbiAgICBtYWluOiBJQ2l0eTtcbiAgICBsYXRpdHVkZTogbnVtYmVyO1xuICAgIGxvbmdpdHVkZTogbnVtYmVyO1xuXG59XG5cblxuaW50ZXJmYWNlIElzdGF0ZSB7XG4gICAgcmVnaW9uczogSUdlb2NvZGVzW107XG4gICAgYm91bmRhcmllczogSUJvdW5kYXJ5W107XG4gICAgY2FwaXRhbDogSUNpdHk7XG4gICAgbmF0aXZlTmFtZTogc3RyaW5nO1xuICAgIGxhdGxuZzogbnVtYmVyW107XG4gICAgaXNvTGFuZzogc3RyaW5nW107XG4gICAgbmFtZTogc3RyaW5nO1xuICAgIHR6OiBzdHJpbmc7XG4gICAgY291bnRyeTogc3RyaW5nO1xuICAgIHN1YmNvbnRpbmVudDogc3RyaW5nO1xuICAgIGNvbnRpbmVudDogc3RyaW5nO1xuXG59XG5cbmludGVyZmFjZSBJQ291bnRyeSB7XG4gICAgc3RhdGVzOiBJc3RhdGVbXTtcbiAgICBuYW1lOiBzdHJpbmc7XG4gICAgYm91bmRhcmllczogSUJvdW5kYXJ5W107XG4gICAgbmF0aXZlTmFtZTogc3RyaW5nO1xuICAgIGNhcGl0YWw6IElDaXR5O1xuICAgIGN1cnJlbmNpZXM6IHN0cmluZ1tdO1xuICAgIGlzb0xhbmc6IHN0cmluZ1tdO1xuICAgIGxhdGxuZzogbnVtYmVyW107XG4gICAgdHo6IHN0cmluZztcbiAgICBzdWJjb250aW5lbnQ6IHN0cmluZztcbiAgICBjb250aW5lbnQ6IHN0cmluZztcblxufVxuXG5pbnRlcmZhY2UgSVN1YmNvbnRpbmVudCB7XG5cbiAgICBuYW1lOiBzdHJpbmc7XG4gICAgY291bnRyaWVzOiBJQ291bnRyeVtdO1xuICAgIGJvdW5kYXJpZXM6IElCb3VuZGFyeVtdO1xuICAgIGNvbnRpbmVudDogc3RyaW5nO1xufVxuXG5pbnRlcmZhY2UgSUdlb2J1aWxkIHtcblxuICAgIG5hbWU6IHN0cmluZztcbiAgICBzdWJjb250aW5lbnRzOiBJU3ViY29udGluZW50W107XG4gICAgYm91bmRhcmllczogSUJvdW5kYXJ5W107XG5cbn1cblxuXG5cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTG9jYWxpemUge1xuICAgIHdvcmxkOiBJR2VvYnVpbGRbXTtcblxuICAgIGNvbnN0cnVjdG9yKHdvcmQ/OiBJR2VvYnVpbGRbXSkge1xuICAgICAgICBpZiAod29yZCkgdGhpcy5sb2FkV29ybGQod29yZClcbiAgICB9XG5cbiAgICBsb2FkV29ybGQod29yZDogSUdlb2J1aWxkW10pIHtcblxuICAgIH1cblxuICAgIGdldFBvc2l0aW9uKG86IHsgbGF0aXR1ZGU6IG51bWJlciwgbG9uZ2l0dWRlOiBudW1iZXIsIHN0YXRlPzogc3RyaW5nIH0pIHtcblxuICAgICAgICBpZiAoIShvICYmIG8ubGF0aXR1ZGUgJiYgby5sb25naXR1ZGUpKSB0aHJvdyBFcnJvcihcIkVycm9yXCIpO1xuXG4gICAgICAgIGxldCBwb3MgPSB7IGxhdGl0dWRlOiBvLmxhdGl0dWRlLCBsb25naXR1ZGU6IG8ubG9uZ2l0dWRlIH07XG5cbiAgICAgICAgbGV0IF90aGlzID0gdGhpcztcbiAgICAgICAgbGV0IFN0YXRlOiBJc3RhdGU7XG4gICAgICAgIGlmIChvLnN0YXRlICYmIF90aGlzLmdldFN0YXRlKG8uc3RhdGUpKSB7XG4gICAgICAgICAgICBTdGF0ZSA9IDxJc3RhdGU+X3RoaXMuZ2V0U3RhdGUoby5zdGF0ZSlcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzcycpO1xuXG5cblxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ3RvZG8nKTtcblxuICAgICAgICAgICAgdGhyb3cgRXJyb3IoXCJ0b2RvXCIpO1xuXG5cbiAgICAgICAgfVxuXG5cbiAgICAgICAgLy8gbGl2ZWxsbyBuYXppb25hbGVcbiAgICAgICAgbGV0IGFsbHByb3ZpbmNlcyA9IF90aGlzLmdldFByb3ZpbmNlc0Zyb21TdGF0ZShTdGF0ZS5uYW1lKTtcblxuXG4gICAgICAgIF8ubWFwKGFsbHByb3ZpbmNlcywgZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIGMuZGlzdGFuY2UgPSBnZW8uZ2V0RGlzdGFuY2UoeyBsYXRpdHVkZTogYy5sYXRpdHVkZSwgbG9uZ2l0dWRlOiBjLmxvbmdpdHVkZSB9LCBwb3MpO1xuXG4gICAgICAgIH0pXG5cblxuICAgICAgICBsZXQgcmVwcm92ID0gXy50YWtlKF8ub3JkZXJCeShhbGxwcm92aW5jZXMsIFsnZGlzdGFuY2UnXSwgWydhc2MnXSksIDIpO1xuXG4gICAgICAgIGxldCBwcm92aW5jZXMgPSBbXTtcbiAgICAgICAgXy5tYXAocmVwcm92LCBmdW5jdGlvbiAoYzogSUNpdHkpIHtcblxuICAgICAgICAgICAgXy5tYXAoX3RoaXMuZ2V0Q2l0aWVzRnJvbVByb3ZpbmNlcyhjLm5hdGl2ZU5hbWUsIFN0YXRlLm5hbWUpLCBmdW5jdGlvbiAocCkge1xuICAgICAgICAgICAgICAgIHAuZGlzdGFuY2UgPSBnZW8uZ2V0RGlzdGFuY2UoeyBsYXRpdHVkZTogcC5sYXRpdHVkZSwgbG9uZ2l0dWRlOiBwLmxvbmdpdHVkZSB9LCBwb3MpO1xuXG4gICAgICAgICAgICAgICAgcHJvdmluY2VzLnB1c2gocClcbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgfSlcblxuXG4gICAgICAgIGxldCBjaXRpZXM6IElDaXR5W10gPSA8SUNpdHlbXT5fLnRha2UoXy5vcmRlckJ5KHByb3ZpbmNlcywgWydkaXN0YW5jZSddLCBbJ2FzYyddKSwgMik7XG5cbiAgICAgICAgaWYgKGNpdGllc1swXS5kaXN0YW5jZSAqIDEuNCA+IGNpdGllc1swXS5kaXN0YW5jZSkge1xuICAgICAgICAgICAgY2l0aWVzID0gW2NpdGllc1swXV1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBjaXRpZXNcblxuXG4gICAgfVxuXG5cbiAgICBnZXRMb2NhdGlvbihvOiB7IGNpdHk6IHN0cmluZywgc3RhdGU/OiBzdHJpbmcgfSkge1xuICAgICAgICByZXR1cm4gdHJ1ZVxuXG4gICAgfVxuXG4gICAgZ2V0aW5mbyhvOiB7IGNpdHk6IHN0cmluZywgc3RhdGU/OiBzdHJpbmcgfSkge1xuICAgICAgICByZXR1cm4gdHJ1ZVxuICAgIH1cblxuICAgIGdldFN0YXRlKHN0YXRlOiBzdHJpbmcsIG8/OiB7IGNvbnRpbmVudD86IHN0cmluZyB9KTogSXN0YXRlIHwgYm9vbGVhbiB7XG5cblxuICAgICAgICBsZXQgZXhpc3RzID0gZmFsc2U7XG5cbiAgICAgICAgbGV0IGFuc3dlcjtcblxuICAgICAgICBsZXQgX3RoaXMgPSB0aGlzO1xuXG4gICAgICAgIGlmICghX3RoaXMud29ybGQpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJubyB3b3JsZFwiKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgICB9XG5cbiAgICAgICAgXy5tYXAoX3RoaXMud29ybGQsIGZ1bmN0aW9uIChjb250aW5lbnQpIHtcblxuICAgICAgICAgICAgXy5tYXAoY29udGluZW50LnN1YmNvbnRpbmVudHMsIGZ1bmN0aW9uIChzdWJjb250aW5lbnQpIHtcblxuICAgICAgICAgICAgICAgIF8ubWFwKHN1YmNvbnRpbmVudC5jb3VudHJpZXMsIGZ1bmN0aW9uIChjb3VudHJ5KSB7XG5cbiAgICAgICAgICAgICAgICAgICAgXy5tYXAoY291bnRyeS5zdGF0ZXMsIGZ1bmN0aW9uIChzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhzLm5hbWUpXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocy5uYW1lID09PSBzdGF0ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4aXN0cyA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5zd2VyID0gc1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG5cbiAgICAgICAgICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIWV4aXN0cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgYW5zd2VyID0gZmFsc2VcblxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgfSlcblxuICAgICAgICB9KVxuXG5cbiAgICAgICAgcmV0dXJuIGFuc3dlclxuXG4gICAgfVxuXG4gICAgZ2V0UHJvdmluY2VzRnJvbVN0YXRlKHN0YXRlKSB7XG5cbiAgICAgICAgbGV0IF90aGlzID0gdGhpcztcbiAgICAgICAgbGV0IFN0YXRlOiBJc3RhdGU7XG5cbiAgICAgICAgaWYgKHN0YXRlKSB7XG4gICAgICAgICAgICBTdGF0ZSA9IDxJc3RhdGU+X3RoaXMuZ2V0U3RhdGUoc3RhdGUpXG5cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRocm93IEVycm9yKFwidG9kb1wiKTtcblxuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHByb3ZpbmNlczogSUNpdHlbXSA9IFtdO1xuICAgICAgICBfLm1hcChTdGF0ZS5yZWdpb25zLCBmdW5jdGlvbiAocikge1xuICAgICAgICAgICAgXy5tYXAoci5jaXRpZXMsIGZ1bmN0aW9uIChjKSB7XG5cbiAgICAgICAgICAgICAgICBwcm92aW5jZXMucHVzaChjKVxuXG4gICAgICAgICAgICB9KVxuXG4gICAgICAgIH0pXG5cblxuICAgICAgICByZXR1cm4gcHJvdmluY2VzXG5cbiAgICB9XG5cbiAgICBnZXRDaXRpZXNGcm9tUHJvdmluY2VzKGNpdHksIHN0YXRlPzogc3RyaW5nKSB7XG5cbiAgICAgICAgbGV0IF90aGlzID0gdGhpcztcbiAgICAgICAgbGV0IFN0YXRlOiBJc3RhdGU7XG5cbiAgICAgICAgaWYgKHN0YXRlKSB7XG4gICAgICAgICAgICBTdGF0ZSA9IDxJc3RhdGU+X3RoaXMuZ2V0U3RhdGUoc3RhdGUpXG5cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRocm93IEVycm9yKFwidG9kb1wiKTtcblxuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHByb3ZpbmNlczogSUNpdHlbXSA9IFtdO1xuICAgICAgICBfLm1hcChTdGF0ZS5yZWdpb25zLCBmdW5jdGlvbiAocikge1xuICAgICAgICAgICAgXy5tYXAoci5wcm92aW5jZXMsIGZ1bmN0aW9uIChwKSB7XG4gICAgICAgICAgICAgICAgaWYgKHAubWFpbi5uYXRpdmVOYW1lID09PSBjaXR5KSB7XG4gICAgICAgICAgICAgICAgICAgIF8ubWFwKHAuY2l0aWVzLCBmdW5jdGlvbiAoYykge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm92aW5jZXMucHVzaChjKVxuXG5cbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB9XG5cblxuICAgICAgICAgICAgfSlcblxuICAgICAgICB9KVxuXG5cbiAgICAgICAgcmV0dXJuIHByb3ZpbmNlc1xuXG4gICAgfVxuXG59Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
