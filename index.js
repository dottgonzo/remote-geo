"use strict";
var _ = require("lodash");
var geo = require("geolib");
var Localize = (function () {
    function Localize(world) {
        if (world)
            this.loadWorld(world);
    }
    Localize.prototype.loadWorld = function (world) {
        this.world = world;
    };
    Localize.prototype.downloadWorld = function (o) {
    };
    Localize.prototype.loadState = function (state) {
    };
    Localize.prototype.downloadState = function (o) {
    };
    Localize.prototype.getStateFromPosition = function (o) {
    };
    Localize.prototype.getPosition = function (o) {
        if (!(o && o.latitude && o.longitude))
            throw Error("Error");
        var pos = { latitude: o.latitude, longitude: o.longitude };
        var _this = this;
        var State;
        if (o.state && _this.getState(o.state)) {
            State = _this.getState(o.state);
            console.log('ss');
        }
        else {
            console.log('todo');
            throw Error("todo");
        }
        var allprovinces = _this.getProvincesFromState(State.name);
        _.map(allprovinces, function (c) {
            c.distance = geo.getDistance({ latitude: c.latitude, longitude: c.longitude }, pos);
        });
        var reprov = _.take(_.orderBy(allprovinces, ['distance'], ['asc']), 2);
        var provinces = [];
        _.map(reprov, function (c) {
            _.map(_this.getCitiesFromProvinces(c.nativeName, State.name), function (p) {
                p.distance = geo.getDistance({ latitude: p.latitude, longitude: p.longitude }, pos);
                provinces.push(p);
            });
        });
        var cities = _.take(_.orderBy(provinces, ['distance'], ['asc']), 2);
        if (cities[0].distance * 1.4 > cities[0].distance) {
            cities = [cities[0]];
        }
        return cities;
    };
    Localize.prototype.getLocation = function (o) {
        return true;
    };
    Localize.prototype.getinfo = function (o) {
        return true;
    };
    Localize.prototype.getState = function (state, o) {
        var exists = false;
        var answer;
        var _this = this;
        if (!_this.world) {
            console.error("no world");
            return false;
        }
        _.map(_this.world, function (continent) {
            _.map(continent.subcontinents, function (subcontinent) {
                _.map(subcontinent.countries, function (country) {
                    _.map(country.states, function (s) {
                        console.log(s.name);
                        if (s.name === state) {
                            exists = true;
                            answer = s;
                        }
                    });
                    if (!exists) {
                        answer = false;
                    }
                });
            });
        });
        return answer;
    };
    Localize.prototype.getProvincesFromState = function (state) {
        var _this = this;
        var State;
        if (state) {
            State = _this.getState(state);
        }
        else {
            throw Error("todo");
        }
        var provinces = [];
        _.map(State.regions, function (r) {
            _.map(r.cities, function (c) {
                provinces.push(c);
            });
        });
        return provinces;
    };
    Localize.prototype.getCitiesFromProvinces = function (city, state) {
        var _this = this;
        var State;
        if (state) {
            State = _this.getState(state);
        }
        else {
            throw Error("todo");
        }
        var provinces = [];
        _.map(State.regions, function (r) {
            _.map(r.provinces, function (p) {
                if (p.main.nativeName === city) {
                    _.map(p.cities, function (c) {
                        provinces.push(c);
                    });
                }
            });
        });
        return provinces;
    };
    return Localize;
}());
Object.defineProperty(exports, "__esModule", { value: true });
exports.default = Localize;

//# sourceMappingURL=data:application/json;base64,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aFwiO1xuXG5sZXQgZ2VvID0gcmVxdWlyZShcImdlb2xpYlwiKTtcblxuaW50ZXJmYWNlIElCb3VuZGFyeSB7XG5cbiAgICBsYXRpdHVkZTogbnVtYmVyO1xuICAgIGxvbmdpdHVkZTogbnVtYmVyO1xuXG59XG5cbmludGVyZmFjZSBJR2VvY29kZXMge1xuICAgIG5hbWU6IHN0cmluZztcbiAgICBwcm92aW5jZXM6IElHZW9bXTtcbiAgICBjaXRpZXM6IElDaXR5W11cbn1cblxuXG5cbmludGVyZmFjZSBJQ2l0eSB7XG4gICAgbmF0aXZlTmFtZTogc3RyaW5nO1xuICAgIGxhdGl0dWRlOiBudW1iZXI7XG4gICAgbG9uZ2l0dWRlOiBudW1iZXI7XG4gICAgemlwY29kZTogbnVtYmVyO1xuICAgIGNpdHlDb2RlOiBzdHJpbmc7XG4gICAgc3RhdGU6IHN0cmluZztcbiAgICBjb3VudHJ5OiBzdHJpbmc7XG4gICAgaXNvTGFuZzogc3RyaW5nO1xuICAgIHR6OiBzdHJpbmc7XG4gICAgY3VycmVuY3k6IHN0cmluZztcbiAgICBjdXJyZW5jeVN5bWJvbDogc3RyaW5nO1xuICAgIGRpc3RhbmNlPzogbnVtYmVyO1xuICAgIHN1YmNvbnRpbmVudDogc3RyaW5nO1xuICAgIGNvbnRpbmVudDogc3RyaW5nO1xuICAgIHJlZ2lvbjogc3RyaW5nO1xufVxuXG5pbnRlcmZhY2UgSUdlbyB7XG4gICAgbmF0aXZlTmFtZTogc3RyaW5nO1xuICAgIHppcGNvZGU6IHN0cmluZztcbiAgICBjaXRpZXM6IElDaXR5W107XG4gICAgbWFpbjogSUNpdHk7XG4gICAgbGF0aXR1ZGU6IG51bWJlcjtcbiAgICBsb25naXR1ZGU6IG51bWJlcjtcblxufVxuXG5cbmludGVyZmFjZSBJc3RhdGUge1xuICAgIHJlZ2lvbnM6IElHZW9jb2Rlc1tdO1xuICAgIGJvdW5kYXJpZXM6IElCb3VuZGFyeVtdO1xuICAgIGNhcGl0YWw6IElDaXR5O1xuICAgIG5hdGl2ZU5hbWU6IHN0cmluZztcbiAgICBsYXRsbmc6IG51bWJlcltdO1xuICAgIGlzb0xhbmc6IHN0cmluZ1tdO1xuICAgIG5hbWU6IHN0cmluZztcbiAgICB0ejogc3RyaW5nO1xuICAgIGNvdW50cnk6IHN0cmluZztcbiAgICBzdWJjb250aW5lbnQ6IHN0cmluZztcbiAgICBjb250aW5lbnQ6IHN0cmluZztcblxufVxuXG5pbnRlcmZhY2UgSUNvdW50cnkge1xuICAgIHN0YXRlczogSXN0YXRlW107XG4gICAgbmFtZTogc3RyaW5nO1xuICAgIGJvdW5kYXJpZXM6IElCb3VuZGFyeVtdO1xuICAgIG5hdGl2ZU5hbWU6IHN0cmluZztcbiAgICBjYXBpdGFsOiBJQ2l0eTtcbiAgICBjdXJyZW5jaWVzOiBzdHJpbmdbXTtcbiAgICBpc29MYW5nOiBzdHJpbmdbXTtcbiAgICBsYXRsbmc6IG51bWJlcltdO1xuICAgIHR6OiBzdHJpbmc7XG4gICAgc3ViY29udGluZW50OiBzdHJpbmc7XG4gICAgY29udGluZW50OiBzdHJpbmc7XG5cbn1cblxuaW50ZXJmYWNlIElTdWJjb250aW5lbnQge1xuXG4gICAgbmFtZTogc3RyaW5nO1xuICAgIGNvdW50cmllczogSUNvdW50cnlbXTtcbiAgICBib3VuZGFyaWVzOiBJQm91bmRhcnlbXTtcbiAgICBjb250aW5lbnQ6IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIElHZW9idWlsZCB7XG5cbiAgICBuYW1lOiBzdHJpbmc7XG4gICAgc3ViY29udGluZW50czogSVN1YmNvbnRpbmVudFtdO1xuICAgIGJvdW5kYXJpZXM6IElCb3VuZGFyeVtdO1xuXG59XG5cblxuXG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIExvY2FsaXplIHtcbiAgICB3b3JsZDogSUdlb2J1aWxkW107XG5cbiAgICBjb25zdHJ1Y3Rvcih3b3JsZD86IElHZW9idWlsZFtdKSB7XG4gICAgICAgIGlmICh3b3JsZCkgdGhpcy5sb2FkV29ybGQod29ybGQpXG4gICAgfVxuXG4gICAgbG9hZFdvcmxkKHdvcmxkOiBJR2VvYnVpbGRbXSkge1xuICAgICAgICB0aGlzLndvcmxkID0gd29ybGQ7XG4gICAgfVxuXG4gICAgZG93bmxvYWRXb3JsZChvOiB7IHVybDogc3RyaW5nIH0pIHtcblxuICAgIH1cblxuICAgIGxvYWRTdGF0ZShzdGF0ZTogSXN0YXRlKSB7XG5cbiAgICB9XG5cblxuICAgIGRvd25sb2FkU3RhdGUobzogeyB1cmw6IHN0cmluZyB9KSB7XG5cbiAgICB9XG5cblxuICAgIGdldFN0YXRlRnJvbVBvc2l0aW9uKG86e3N0YXRlOnN0cmluZyxsYXRpdHVkZTpudW1iZXIsbG9uZ2l0dWRlOm51bWJlcn0pe1xuXG5cblxuICAgIH1cblxuICAgIGdldFBvc2l0aW9uKG86IHsgbGF0aXR1ZGU6IG51bWJlciwgbG9uZ2l0dWRlOiBudW1iZXIsIHN0YXRlPzogc3RyaW5nIH0pIHtcblxuICAgICAgICBpZiAoIShvICYmIG8ubGF0aXR1ZGUgJiYgby5sb25naXR1ZGUpKSB0aHJvdyBFcnJvcihcIkVycm9yXCIpO1xuXG4gICAgICAgIGxldCBwb3MgPSB7IGxhdGl0dWRlOiBvLmxhdGl0dWRlLCBsb25naXR1ZGU6IG8ubG9uZ2l0dWRlIH07XG5cbiAgICAgICAgbGV0IF90aGlzID0gdGhpcztcbiAgICAgICAgbGV0IFN0YXRlOiBJc3RhdGU7XG4gICAgICAgIGlmIChvLnN0YXRlICYmIF90aGlzLmdldFN0YXRlKG8uc3RhdGUpKSB7XG4gICAgICAgICAgICBTdGF0ZSA9IDxJc3RhdGU+X3RoaXMuZ2V0U3RhdGUoby5zdGF0ZSlcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzcycpO1xuXG5cblxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ3RvZG8nKTtcblxuICAgICAgICAgICAgdGhyb3cgRXJyb3IoXCJ0b2RvXCIpO1xuXG5cbiAgICAgICAgfVxuXG5cbiAgICAgICAgLy8gbGl2ZWxsbyBuYXppb25hbGVcbiAgICAgICAgbGV0IGFsbHByb3ZpbmNlcyA9IF90aGlzLmdldFByb3ZpbmNlc0Zyb21TdGF0ZShTdGF0ZS5uYW1lKTtcblxuXG4gICAgICAgIF8ubWFwKGFsbHByb3ZpbmNlcywgZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIGMuZGlzdGFuY2UgPSBnZW8uZ2V0RGlzdGFuY2UoeyBsYXRpdHVkZTogYy5sYXRpdHVkZSwgbG9uZ2l0dWRlOiBjLmxvbmdpdHVkZSB9LCBwb3MpO1xuXG4gICAgICAgIH0pXG5cblxuICAgICAgICBsZXQgcmVwcm92ID0gXy50YWtlKF8ub3JkZXJCeShhbGxwcm92aW5jZXMsIFsnZGlzdGFuY2UnXSwgWydhc2MnXSksIDIpO1xuXG4gICAgICAgIGxldCBwcm92aW5jZXMgPSBbXTtcbiAgICAgICAgXy5tYXAocmVwcm92LCBmdW5jdGlvbiAoYzogSUNpdHkpIHtcblxuICAgICAgICAgICAgXy5tYXAoX3RoaXMuZ2V0Q2l0aWVzRnJvbVByb3ZpbmNlcyhjLm5hdGl2ZU5hbWUsIFN0YXRlLm5hbWUpLCBmdW5jdGlvbiAocCkge1xuICAgICAgICAgICAgICAgIHAuZGlzdGFuY2UgPSBnZW8uZ2V0RGlzdGFuY2UoeyBsYXRpdHVkZTogcC5sYXRpdHVkZSwgbG9uZ2l0dWRlOiBwLmxvbmdpdHVkZSB9LCBwb3MpO1xuXG4gICAgICAgICAgICAgICAgcHJvdmluY2VzLnB1c2gocClcbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgfSlcblxuXG4gICAgICAgIGxldCBjaXRpZXM6IElDaXR5W10gPSA8SUNpdHlbXT5fLnRha2UoXy5vcmRlckJ5KHByb3ZpbmNlcywgWydkaXN0YW5jZSddLCBbJ2FzYyddKSwgMik7XG5cbiAgICAgICAgaWYgKGNpdGllc1swXS5kaXN0YW5jZSAqIDEuNCA+IGNpdGllc1swXS5kaXN0YW5jZSkge1xuICAgICAgICAgICAgY2l0aWVzID0gW2NpdGllc1swXV1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBjaXRpZXNcblxuXG4gICAgfVxuXG5cbiAgICBnZXRMb2NhdGlvbihvOiB7IGNpdHk6IHN0cmluZywgc3RhdGU/OiBzdHJpbmcgfSkge1xuICAgICAgICByZXR1cm4gdHJ1ZVxuXG4gICAgfVxuXG4gICAgZ2V0aW5mbyhvOiB7IGNpdHk6IHN0cmluZywgc3RhdGU/OiBzdHJpbmcgfSkge1xuICAgICAgICByZXR1cm4gdHJ1ZVxuICAgIH1cblxuICAgIGdldFN0YXRlKHN0YXRlOiBzdHJpbmcsIG8/OiB7IGNvbnRpbmVudD86IHN0cmluZyB9KTogSXN0YXRlIHwgYm9vbGVhbiB7XG5cblxuICAgICAgICBsZXQgZXhpc3RzID0gZmFsc2U7XG5cbiAgICAgICAgbGV0IGFuc3dlcjtcblxuICAgICAgICBsZXQgX3RoaXMgPSB0aGlzO1xuXG4gICAgICAgIGlmICghX3RoaXMud29ybGQpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJubyB3b3JsZFwiKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgICB9XG5cbiAgICAgICAgXy5tYXAoX3RoaXMud29ybGQsIGZ1bmN0aW9uIChjb250aW5lbnQpIHtcblxuICAgICAgICAgICAgXy5tYXAoY29udGluZW50LnN1YmNvbnRpbmVudHMsIGZ1bmN0aW9uIChzdWJjb250aW5lbnQpIHtcblxuICAgICAgICAgICAgICAgIF8ubWFwKHN1YmNvbnRpbmVudC5jb3VudHJpZXMsIGZ1bmN0aW9uIChjb3VudHJ5KSB7XG5cbiAgICAgICAgICAgICAgICAgICAgXy5tYXAoY291bnRyeS5zdGF0ZXMsIGZ1bmN0aW9uIChzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhzLm5hbWUpXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocy5uYW1lID09PSBzdGF0ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4aXN0cyA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5zd2VyID0gc1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG5cbiAgICAgICAgICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIWV4aXN0cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgYW5zd2VyID0gZmFsc2VcblxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgfSlcblxuICAgICAgICB9KVxuXG5cbiAgICAgICAgcmV0dXJuIGFuc3dlclxuXG4gICAgfVxuXG4gICAgZ2V0UHJvdmluY2VzRnJvbVN0YXRlKHN0YXRlKSB7XG5cbiAgICAgICAgbGV0IF90aGlzID0gdGhpcztcbiAgICAgICAgbGV0IFN0YXRlOiBJc3RhdGU7XG5cbiAgICAgICAgaWYgKHN0YXRlKSB7XG4gICAgICAgICAgICBTdGF0ZSA9IDxJc3RhdGU+X3RoaXMuZ2V0U3RhdGUoc3RhdGUpXG5cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRocm93IEVycm9yKFwidG9kb1wiKTtcblxuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHByb3ZpbmNlczogSUNpdHlbXSA9IFtdO1xuICAgICAgICBfLm1hcChTdGF0ZS5yZWdpb25zLCBmdW5jdGlvbiAocikge1xuICAgICAgICAgICAgXy5tYXAoci5jaXRpZXMsIGZ1bmN0aW9uIChjKSB7XG5cbiAgICAgICAgICAgICAgICBwcm92aW5jZXMucHVzaChjKVxuXG4gICAgICAgICAgICB9KVxuXG4gICAgICAgIH0pXG5cblxuICAgICAgICByZXR1cm4gcHJvdmluY2VzXG5cbiAgICB9XG5cbiAgICBnZXRDaXRpZXNGcm9tUHJvdmluY2VzKGNpdHksIHN0YXRlPzogc3RyaW5nKSB7XG5cbiAgICAgICAgbGV0IF90aGlzID0gdGhpcztcbiAgICAgICAgbGV0IFN0YXRlOiBJc3RhdGU7XG5cbiAgICAgICAgaWYgKHN0YXRlKSB7XG4gICAgICAgICAgICBTdGF0ZSA9IDxJc3RhdGU+X3RoaXMuZ2V0U3RhdGUoc3RhdGUpXG5cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRocm93IEVycm9yKFwidG9kb1wiKTtcblxuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHByb3ZpbmNlczogSUNpdHlbXSA9IFtdO1xuICAgICAgICBfLm1hcChTdGF0ZS5yZWdpb25zLCBmdW5jdGlvbiAocikge1xuICAgICAgICAgICAgXy5tYXAoci5wcm92aW5jZXMsIGZ1bmN0aW9uIChwKSB7XG4gICAgICAgICAgICAgICAgaWYgKHAubWFpbi5uYXRpdmVOYW1lID09PSBjaXR5KSB7XG4gICAgICAgICAgICAgICAgICAgIF8ubWFwKHAuY2l0aWVzLCBmdW5jdGlvbiAoYykge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm92aW5jZXMucHVzaChjKVxuXG5cbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB9XG5cblxuICAgICAgICAgICAgfSlcblxuICAgICAgICB9KVxuXG5cbiAgICAgICAgcmV0dXJuIHByb3ZpbmNlc1xuXG4gICAgfVxuXG59Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
