"use strict";
var _ = require("lodash");
var geo = require("geolib");
var world = require("./world.json");
var Localize = (function () {
    function Localize(word) {
        if (word)
            this.loadWorld(word);
    }
    Localize.prototype.loadWorld = function (word) {
    };
    Localize.prototype.getPosition = function (o) {
        if (!(o && o.latitude && o.longitude))
            throw Error("Error");
        var pos = { latitude: o.latitude, longitude: o.longitude };
        var _this = this;
        var State;
        if (o.state && _this.getState(o.state)) {
            State = _this.getState(o.state);
            console.log('ss');
        }
        else {
            console.log('todo');
            throw Error("todo");
        }
        var allprovinces = _this.getProvincesFromState(State.name);
        _.map(allprovinces, function (c) {
            c.distance = geo.getDistance({ latitude: c.latitude, longitude: c.longitude }, pos);
        });
        var reprov = _.take(_.orderBy(allprovinces, ['distance'], ['asc']), 2);
        var provinces = [];
        _.map(reprov, function (c) {
            _.map(_this.getCitiesFromProvinces(c.nativeName, State.name), function (p) {
                p.distance = geo.getDistance({ latitude: p.latitude, longitude: p.longitude }, pos);
                provinces.push(p);
            });
        });
        var cities = _.take(_.orderBy(provinces, ['distance'], ['asc']), 2);
        if (cities[0].distance * 1.4 > cities[0].distance) {
            cities = [cities[0]];
        }
        return cities;
    };
    Localize.prototype.getLocation = function (o) {
        return true;
    };
    Localize.prototype.getinfo = function (o) {
        return true;
    };
    Localize.prototype.getState = function (state, o) {
        var exists = false;
        var answer;
        var _this = this;
        if (!_this.world) {
            console.error("no world");
            return false;
        }
        _.map(_this.world, function (continent) {
            _.map(continent.subcontinents, function (subcontinent) {
                _.map(subcontinent.countries, function (country) {
                    _.map(country.states, function (s) {
                        console.log(s.name);
                        if (s.name === state) {
                            exists = true;
                            answer = s;
                        }
                    });
                    if (!exists) {
                        answer = false;
                    }
                });
            });
        });
        return answer;
    };
    Localize.prototype.getProvincesFromState = function (state) {
        var _this = this;
        var State;
        if (state) {
            State = _this.getState(state);
        }
        else {
            throw Error("todo");
        }
        var provinces = [];
        _.map(State.regions, function (r) {
            _.map(r.cities, function (c) {
                provinces.push(c);
            });
        });
        return provinces;
    };
    Localize.prototype.getCitiesFromProvinces = function (city, state) {
        var _this = this;
        var State;
        if (state) {
            State = _this.getState(state);
        }
        else {
            throw Error("todo");
        }
        var provinces = [];
        _.map(State.regions, function (r) {
            _.map(r.provinces, function (p) {
                if (p.main.nativeName === city) {
                    _.map(p.cities, function (c) {
                        provinces.push(c);
                    });
                }
            });
        });
        return provinces;
    };
    return Localize;
}());
Object.defineProperty(exports, "__esModule", { value: true });
exports.default = Localize;

//# sourceMappingURL=data:application/json;base64,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O1FBRXZDLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQztRQUNqQixJQUFJLEtBQWEsQ0FBQztRQUVsQixFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1lBQ1IsS0FBSyxHQUFXLEtBQUssQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUE7UUFFekMsQ0FBQztRQUFDLElBQUksQ0FBQyxDQUFDO1lBQ0osTUFBTSxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7UUFFeEIsQ0FBQztRQUVELElBQUksU0FBUyxHQUFZLEVBQUUsQ0FBQztRQUM1QixDQUFDLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsVUFBVSxDQUFDO1lBQzVCLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLFNBQVMsRUFBRSxVQUFVLENBQUM7Z0JBQzFCLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVSxLQUFLLElBQUksQ0FBQyxDQUFDLENBQUM7b0JBQzdCLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLE1BQU0sRUFBRSxVQUFVLENBQUM7d0JBRXZCLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUE7b0JBR3JCLENBQUMsQ0FBQyxDQUFBO2dCQUNOLENBQUM7WUFHTCxDQUFDLENBQUMsQ0FBQTtRQUVOLENBQUMsQ0FBQyxDQUFBO1FBR0YsTUFBTSxDQUFDLFNBQVMsQ0FBQTtJQUVwQixDQUFDO0lBRUwsZUFBQztBQUFELENBN0xBLEFBNkxDLElBQUE7QUE3TEQ7MEJBNkxDLENBQUEiLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBfIGZyb20gXCJsb2Rhc2hcIjtcblxubGV0IGdlbyA9IHJlcXVpcmUoXCJnZW9saWJcIik7XG5cbmludGVyZmFjZSBJQm91bmRhcnkge1xuXG4gICAgbGF0aXR1ZGU6IG51bWJlcjtcbiAgICBsb25naXR1ZGU6IG51bWJlcjtcblxufVxuXG5pbnRlcmZhY2UgSUdlb2NvZGVzIHtcbiAgICBuYW1lOiBzdHJpbmc7XG4gICAgcHJvdmluY2VzOiBJR2VvW107XG4gICAgY2l0aWVzOiBJQ2l0eVtdXG59XG5cblxuXG5pbnRlcmZhY2UgSUNpdHkge1xuICAgIG5hdGl2ZU5hbWU6IHN0cmluZztcbiAgICBsYXRpdHVkZTogbnVtYmVyO1xuICAgIGxvbmdpdHVkZTogbnVtYmVyO1xuICAgIHppcGNvZGU6IG51bWJlcjtcbiAgICBjaXR5Q29kZTogc3RyaW5nO1xuICAgIHN0YXRlOiBzdHJpbmc7XG4gICAgY291bnRyeTogc3RyaW5nO1xuICAgIGlzb0xhbmc6IHN0cmluZztcbiAgICB0ejogc3RyaW5nO1xuICAgIGN1cnJlbmN5OiBzdHJpbmc7XG4gICAgY3VycmVuY3lTeW1ib2w6IHN0cmluZztcbiAgICBkaXN0YW5jZT86IG51bWJlcjtcbiAgICBzdWJjb250aW5lbnQ6IHN0cmluZztcbiAgICBjb250aW5lbnQ6IHN0cmluZztcbiAgICByZWdpb246IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIElHZW8ge1xuICAgIG5hdGl2ZU5hbWU6IHN0cmluZztcbiAgICB6aXBjb2RlOiBzdHJpbmc7XG4gICAgY2l0aWVzOiBJQ2l0eVtdO1xuICAgIG1haW46IElDaXR5O1xuICAgIGxhdGl0dWRlOiBudW1iZXI7XG4gICAgbG9uZ2l0dWRlOiBudW1iZXI7XG5cbn1cblxuXG5pbnRlcmZhY2UgSXN0YXRlIHtcbiAgICByZWdpb25zOiBJR2VvY29kZXNbXTtcbiAgICBib3VuZGFyaWVzOiBJQm91bmRhcnlbXTtcbiAgICBjYXBpdGFsOiBJQ2l0eTtcbiAgICBuYXRpdmVOYW1lOiBzdHJpbmc7XG4gICAgbGF0bG5nOiBudW1iZXJbXTtcbiAgICBpc29MYW5nOiBzdHJpbmdbXTtcbiAgICBuYW1lOiBzdHJpbmc7XG4gICAgdHo6IHN0cmluZztcbiAgICBjb3VudHJ5OiBzdHJpbmc7XG4gICAgc3ViY29udGluZW50OiBzdHJpbmc7XG4gICAgY29udGluZW50OiBzdHJpbmc7XG5cbn1cblxuaW50ZXJmYWNlIElDb3VudHJ5IHtcbiAgICBzdGF0ZXM6IElzdGF0ZVtdO1xuICAgIG5hbWU6IHN0cmluZztcbiAgICBib3VuZGFyaWVzOiBJQm91bmRhcnlbXTtcbiAgICBuYXRpdmVOYW1lOiBzdHJpbmc7XG4gICAgY2FwaXRhbDogSUNpdHk7XG4gICAgY3VycmVuY2llczogc3RyaW5nW107XG4gICAgaXNvTGFuZzogc3RyaW5nW107XG4gICAgbGF0bG5nOiBudW1iZXJbXTtcbiAgICB0ejogc3RyaW5nO1xuICAgIHN1YmNvbnRpbmVudDogc3RyaW5nO1xuICAgIGNvbnRpbmVudDogc3RyaW5nO1xuXG59XG5cbmludGVyZmFjZSBJU3ViY29udGluZW50IHtcblxuICAgIG5hbWU6IHN0cmluZztcbiAgICBjb3VudHJpZXM6IElDb3VudHJ5W107XG4gICAgYm91bmRhcmllczogSUJvdW5kYXJ5W107XG4gICAgY29udGluZW50OiBzdHJpbmc7XG59XG5cbmludGVyZmFjZSBJR2VvYnVpbGQge1xuXG4gICAgbmFtZTogc3RyaW5nO1xuICAgIHN1YmNvbnRpbmVudHM6IElTdWJjb250aW5lbnRbXTtcbiAgICBib3VuZGFyaWVzOiBJQm91bmRhcnlbXTtcblxufVxuXG5cblxubGV0IHdvcmxkOiBJR2VvYnVpbGRbXSA9IHJlcXVpcmUoXCIuL3dvcmxkLmpzb25cIik7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIExvY2FsaXplIHtcbiAgICB3b3JsZDogSUdlb2J1aWxkW107XG5cbiAgICBjb25zdHJ1Y3Rvcih3b3JkPzogSUdlb2J1aWxkW10pIHtcbiAgICAgICAgaWYgKHdvcmQpIHRoaXMubG9hZFdvcmxkKHdvcmQpXG4gICAgfVxuXG4gICAgbG9hZFdvcmxkKHdvcmQ6IElHZW9idWlsZFtdKSB7XG5cbiAgICB9XG5cbiAgICBnZXRQb3NpdGlvbihvOiB7IGxhdGl0dWRlOiBudW1iZXIsIGxvbmdpdHVkZTogbnVtYmVyLCBzdGF0ZT86IHN0cmluZyB9KSB7XG5cbiAgICAgICAgaWYgKCEobyAmJiBvLmxhdGl0dWRlICYmIG8ubG9uZ2l0dWRlKSkgdGhyb3cgRXJyb3IoXCJFcnJvclwiKTtcblxuICAgICAgICBsZXQgcG9zID0geyBsYXRpdHVkZTogby5sYXRpdHVkZSwgbG9uZ2l0dWRlOiBvLmxvbmdpdHVkZSB9O1xuXG4gICAgICAgIGxldCBfdGhpcyA9IHRoaXM7XG4gICAgICAgIGxldCBTdGF0ZTogSXN0YXRlO1xuICAgICAgICBpZiAoby5zdGF0ZSAmJiBfdGhpcy5nZXRTdGF0ZShvLnN0YXRlKSkge1xuICAgICAgICAgICAgU3RhdGUgPSA8SXN0YXRlPl90aGlzLmdldFN0YXRlKG8uc3RhdGUpXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnc3MnKTtcblxuXG5cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCd0b2RvJyk7XG5cbiAgICAgICAgICAgIHRocm93IEVycm9yKFwidG9kb1wiKTtcblxuXG4gICAgICAgIH1cblxuXG4gICAgICAgIC8vIGxpdmVsbG8gbmF6aW9uYWxlXG4gICAgICAgIGxldCBhbGxwcm92aW5jZXMgPSBfdGhpcy5nZXRQcm92aW5jZXNGcm9tU3RhdGUoU3RhdGUubmFtZSk7XG5cblxuICAgICAgICBfLm1hcChhbGxwcm92aW5jZXMsIGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICBjLmRpc3RhbmNlID0gZ2VvLmdldERpc3RhbmNlKHsgbGF0aXR1ZGU6IGMubGF0aXR1ZGUsIGxvbmdpdHVkZTogYy5sb25naXR1ZGUgfSwgcG9zKTtcblxuICAgICAgICB9KVxuXG5cblxuXG4gICAgICAgIGxldCByZXByb3YgPSBfLnRha2UoXy5vcmRlckJ5KGFsbHByb3ZpbmNlcywgWydkaXN0YW5jZSddLCBbJ2FzYyddKSwgMik7XG5cbiAgICAgICAgbGV0IHByb3ZpbmNlcyA9IFtdO1xuICAgICAgICBfLm1hcChyZXByb3YsIGZ1bmN0aW9uIChjOiBJQ2l0eSkge1xuXG4gICAgICAgICAgICBfLm1hcChfdGhpcy5nZXRDaXRpZXNGcm9tUHJvdmluY2VzKGMubmF0aXZlTmFtZSwgU3RhdGUubmFtZSksIGZ1bmN0aW9uIChwKSB7XG4gICAgICAgICAgICAgICAgcC5kaXN0YW5jZSA9IGdlby5nZXREaXN0YW5jZSh7IGxhdGl0dWRlOiBwLmxhdGl0dWRlLCBsb25naXR1ZGU6IHAubG9uZ2l0dWRlIH0sIHBvcyk7XG5cbiAgICAgICAgICAgICAgICBwcm92aW5jZXMucHVzaChwKVxuICAgICAgICAgICAgfSlcblxuICAgICAgICB9KVxuXG5cbiAgICAgICAgbGV0IGNpdGllczogSUNpdHlbXSA9IDxJQ2l0eVtdPl8udGFrZShfLm9yZGVyQnkocHJvdmluY2VzLCBbJ2Rpc3RhbmNlJ10sIFsnYXNjJ10pLCAyKTtcblxuICAgICAgICBpZiAoY2l0aWVzWzBdLmRpc3RhbmNlICogMS40ID4gY2l0aWVzWzBdLmRpc3RhbmNlKSB7XG4gICAgICAgICAgICBjaXRpZXMgPSBbY2l0aWVzWzBdXVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGNpdGllc1xuXG5cbiAgICB9XG5cblxuICAgIGdldExvY2F0aW9uKG86IHsgY2l0eTogc3RyaW5nLCBzdGF0ZT86IHN0cmluZyB9KSB7XG4gICAgICAgIHJldHVybiB0cnVlXG5cbiAgICB9XG5cbiAgICBnZXRpbmZvKG86IHsgY2l0eTogc3RyaW5nLCBzdGF0ZT86IHN0cmluZyB9KSB7XG4gICAgICAgIHJldHVybiB0cnVlXG4gICAgfVxuXG4gICAgZ2V0U3RhdGUoc3RhdGU6IHN0cmluZywgbz86IHsgY29udGluZW50Pzogc3RyaW5nIH0pOiBJc3RhdGUgfCBib29sZWFuIHtcblxuXG4gICAgICAgIGxldCBleGlzdHMgPSBmYWxzZTtcblxuICAgICAgICBsZXQgYW5zd2VyO1xuXG4gICAgICAgIGxldCBfdGhpcyA9IHRoaXM7XG5cbiAgICAgICAgaWYgKCFfdGhpcy53b3JsZCkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIm5vIHdvcmxkXCIpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICAgIH1cblxuICAgICAgICBfLm1hcChfdGhpcy53b3JsZCwgZnVuY3Rpb24gKGNvbnRpbmVudCkge1xuXG4gICAgICAgICAgICBfLm1hcChjb250aW5lbnQuc3ViY29udGluZW50cywgZnVuY3Rpb24gKHN1YmNvbnRpbmVudCkge1xuXG4gICAgICAgICAgICAgICAgXy5tYXAoc3ViY29udGluZW50LmNvdW50cmllcywgZnVuY3Rpb24gKGNvdW50cnkpIHtcblxuICAgICAgICAgICAgICAgICAgICBfLm1hcChjb3VudHJ5LnN0YXRlcywgZnVuY3Rpb24gKHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHMubmFtZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzLm5hbWUgPT09IHN0YXRlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhpc3RzID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbnN3ZXIgPSBzXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cblxuICAgICAgICAgICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICAgICAgICAgIGlmICghZXhpc3RzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhbnN3ZXIgPSBmYWxzZVxuXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICB9KVxuXG4gICAgICAgIH0pXG5cblxuICAgICAgICByZXR1cm4gYW5zd2VyXG5cbiAgICB9XG5cbiAgICBnZXRQcm92aW5jZXNGcm9tU3RhdGUoc3RhdGUpIHtcblxuICAgICAgICBsZXQgX3RoaXMgPSB0aGlzO1xuICAgICAgICBsZXQgU3RhdGU6IElzdGF0ZTtcblxuICAgICAgICBpZiAoc3RhdGUpIHtcbiAgICAgICAgICAgIFN0YXRlID0gPElzdGF0ZT5fdGhpcy5nZXRTdGF0ZShzdGF0ZSlcblxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhyb3cgRXJyb3IoXCJ0b2RvXCIpO1xuXG4gICAgICAgIH1cblxuICAgICAgICBsZXQgcHJvdmluY2VzOiBJQ2l0eVtdID0gW107XG4gICAgICAgIF8ubWFwKFN0YXRlLnJlZ2lvbnMsIGZ1bmN0aW9uIChyKSB7XG4gICAgICAgICAgICBfLm1hcChyLmNpdGllcywgZnVuY3Rpb24gKGMpIHtcblxuICAgICAgICAgICAgICAgIHByb3ZpbmNlcy5wdXNoKGMpXG5cbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgfSlcblxuXG4gICAgICAgIHJldHVybiBwcm92aW5jZXNcblxuICAgIH1cblxuICAgIGdldENpdGllc0Zyb21Qcm92aW5jZXMoY2l0eSwgc3RhdGU/OiBzdHJpbmcpIHtcblxuICAgICAgICBsZXQgX3RoaXMgPSB0aGlzO1xuICAgICAgICBsZXQgU3RhdGU6IElzdGF0ZTtcblxuICAgICAgICBpZiAoc3RhdGUpIHtcbiAgICAgICAgICAgIFN0YXRlID0gPElzdGF0ZT5fdGhpcy5nZXRTdGF0ZShzdGF0ZSlcblxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhyb3cgRXJyb3IoXCJ0b2RvXCIpO1xuXG4gICAgICAgIH1cblxuICAgICAgICBsZXQgcHJvdmluY2VzOiBJQ2l0eVtdID0gW107XG4gICAgICAgIF8ubWFwKFN0YXRlLnJlZ2lvbnMsIGZ1bmN0aW9uIChyKSB7XG4gICAgICAgICAgICBfLm1hcChyLnByb3ZpbmNlcywgZnVuY3Rpb24gKHApIHtcbiAgICAgICAgICAgICAgICBpZiAocC5tYWluLm5hdGl2ZU5hbWUgPT09IGNpdHkpIHtcbiAgICAgICAgICAgICAgICAgICAgXy5tYXAocC5jaXRpZXMsIGZ1bmN0aW9uIChjKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHByb3ZpbmNlcy5wdXNoKGMpXG5cblxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIH1cblxuXG4gICAgICAgICAgICB9KVxuXG4gICAgICAgIH0pXG5cblxuICAgICAgICByZXR1cm4gcHJvdmluY2VzXG5cbiAgICB9XG5cbn0iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
